<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Answer Generator</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0; padding: 2rem;
      background: #f5f5f5;
      color: #222;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      max-width: 700px;
      margin-inline: auto;
    }
    header { text-align: center; }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    textarea {
      resize: vertical;
      height: 80px;
      font-size: 1rem;
      padding: 0.5rem;
    }
    button {
      background: #0284c7;
      color: white;
      border: none;
      padding: 0.7rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    #output {
      white-space: pre-wrap;
      background: #fff;
      border-radius: 8px;
      padding: 1rem 1.5rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .small { font-size: 0.85rem; color: #666; }
    @media (max-width: 600px) {
      body { padding: 1rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ§™ TaskWizard AI </h1>
    <h3>Your AI assistant for any task! ðŸª„</h3>
    <p><a class="button" href="https://ilkaysen18.github.io/ai-chatbot/wiki-ai.html" target="_blank" rel="noopener noreferrer">Go to Questions â†—</a></p>
       <nav>
         <a href="wiki-ai.html">Questions</a>
         <a href="ai-generator.html">Tasks</a>
       </nav>
  </header>

  <form id="queryForm">
    <label for="query">Enter a question or topic:</label>
    <textarea id="query" placeholder="e.g., What are the basics of English grammar?"></textarea>
    <button type="submit">Generate Answer</button>
  </form>

  <div id="output" hidden>
    <h2>Answer</h2>
    <p id="answerText">Loading...</p>
    <p class="small" id="sourcesText"></p>
  </div>

  <script>
    const API_KEY = "YOUR_OPENAI_KEY_HERE"; // or use a local LLM API

    async function getWikipediaSummary(query) {
      const res = await fetch(
        `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`
      );
      if (!res.ok) return "";
      const data = await res.json();
      return data.extract || "";
    }

    async function getMyLibraryResources(query) {
      // Your own JSON or REST endpoint (modify URL to your setup)
      const res = await fetch(
        `https://resources.mywebsite.com/api/articles.json`
      );
      if (!res.ok) return [];
      const data = await res.json();
      const lower = query.toLowerCase();
      return data
        .filter(x =>
          x.title.toLowerCase().includes(lower) ||
          (x.tags ?? []).some(t => t.toLowerCase().includes(lower))
        )
        .map(x => x.content);
    }

    async function retrieveRelevantContent(query) {
      const [wiki, myLib] = await Promise.allSettled([
        getWikipediaSummary(query),
        getMyLibraryResources(query),
      ]);
      const snippets = [];
      if (wiki.status === "fulfilled") snippets.push(wiki.value);
      if (myLib.status === "fulfilled") snippets.push(...myLib.value);
      return snippets;
    }

    function buildPrompt(query, sources) {
      const context = sources.join("\n---\n").slice(0, 4000);
      return `
You are a helpful assistant that answers questions based only on the context provided.
If information is missing, answer "I don't have enough information."

User question: ${query}

Context:
${context}

Answer:
`;
    }

    async function generateAnswer(prompt) {
      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${API_KEY}`,
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "gpt-4o-mini",
          messages: [{ role: "user", content: prompt }],
          temperature: 0.4,
        }),
      });
      const data = await res.json();
      return data.choices?.[0]?.message?.content?.trim() || "No answer generated.";
    }

    async function handleQuery(event) {
      event.preventDefault();
      const query = document.getElementById("query").value.trim();
      if (!query) return;
      const output = document.getElementById("output");
      const answerText = document.getElementById("answerText");
      const sourcesText = document.getElementById("sourcesText");
      const button = event.target.querySelector("button");

      output.hidden = false;
      answerText.textContent = "Retrieving content...";
      sourcesText.textContent = "";
      button.disabled = true;

      try {
        const sources = await retrieveRelevantContent(query);
        answerText.textContent = "Generating answer...";
        const prompt = buildPrompt(query, sources);
        const answer = await generateAnswer(prompt);
        answerText.textContent = answer;
        sourcesText.textContent = `Sources used: Wikipedia + MyLibrary (${sources.length} snippets)`;
      } catch (err) {
        answerText.textContent = "Error: " + err.message;
      } finally {
        button.disabled = false;
      }
    }

    document.getElementById("queryForm").addEventListener("submit", handleQuery);
  </script>
</body>
</html>
